%% Copyright 2013 Maïeul Rouquette
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% This work has the LPPL maintenance status `maintained'.
% 
% The Current Maintainer of this work is Maïeul Rouquette
%
% This work consists of the files biblatex-source-division.sty

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{biblatex-source-division}[2013/12/08 v1.0.0-beta source division for eledpar]

% Call the source division getting
\renewbibmacro*{prenote}{%
  \usebibmacro{getsourcedivision}%
  \iffieldundef{prenote}%
    {}%
    {\printfield{prenote}%
     \setunit{\prenotedelim}}}

% Get source division, put in in titladdon field, and delete source division from the postnote field
\newbibmacro{getsourcedivision}{
  \usefield{\getsourcedivision@}{postnote}%
   \restorefield{titleaddon}{\titleaddon}%
   \restorefield{postnote}{\postnote}%
 }
 
% Analyse of the source division

%% Main command
\newrobustcmd*{\getsourcedivision@}[1]{\getsourcedivision@i#1&} 

% Are there parenthesis ?
\def\getsourcedivision@i{%
  \@ifnextchar(%)
    {\getsourcedivision@ii}
    {\getsourcedivision@ii()}}

% Put the source division and "true" postnote in macro
\def\getsourcedivision@ii(#1)#2&{%
  \gdef\titleaddon{#1}%
  \gdef\postnote{#2}
 }
 
\endinput